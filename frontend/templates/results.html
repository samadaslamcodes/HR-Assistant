<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analysis Reports</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap"
        rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            padding-top: 80px;
        }

        .status-card {
            border-left: 4px solid transparent;
            transition: all 0.2s ease;
        }

        .status-strong {
            border-left-color: #10B981;
            background: rgba(16, 185, 129, 0.05);
        }

        .status-partial {
            border-left-color: #F59E0B;
            background: rgba(245, 158, 11, 0.05);
        }

        .status-missing {
            border-left-color: #EF4444;
            background: rgba(239, 68, 68, 0.05);
        }

        .side-panel-item {
            border-bottom: 1px solid #eee;
            padding-bottom: 0.75rem;
            margin-bottom: 0.75rem;
        }

        .side-panel-item:last-child {
            border-bottom: none;
        }

        .text-justified {
            text-align: justify;
        }

        /* Custom Tab Styling */
        .nav-pills .nav-link {
            color: #6c757d;
            background: transparent;
            border: 1px solid transparent;
        }

        .nav-pills .nav-link.active {
            color: #0d6efd;
            background: rgba(13, 110, 253, 0.1);
            border: 1px solid rgba(13, 110, 253, 0.2);
        }
    </style>
</head>

<body>

    <nav class="navbar navbar-expand-lg fixed-top">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="bi bi-robot me-2"></i>HR Assistant
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/about">About</a>
                    </li>
                    <li class="nav-item ms-lg-3">
                        <a href="/" class="btn btn-sm btn-primary-gradient rounded-pill px-4">New Analysis</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container py-4" style="max-width: 1140px;">
        <!-- Header -->
        <div class="row mb-4 align-items-center">
            <div class="col-md-7">
                <h2 class="fw-bold mb-1">Analysis Dashboard</h2>
                <p class="text-muted mb-0">Reviewing candidate compatibility for <strong>Job Match</strong></p>
            </div>
            <div class="col-md-5 text-md-end mt-3 mt-md-0">
                <span class="text-muted me-2 small fw-bold">OVERALL MATCH:</span>
                {% if results.match_percentage >= 70 %}
                <span class="badge bg-warning text-dark px-3 py-2 rounded-pill shadow-sm">Strong Match ({{
                    results.match_percentage }}%)</span>
                {% elif results.match_percentage >= 40 %}
                <span class="badge bg-warning text-dark px-3 py-2 rounded-pill shadow-sm">Medium Match ({{
                    results.match_percentage }}%)</span>
                {% else %}
                <span class="badge bg-danger px-3 py-2 rounded-pill shadow-sm">Low Match ({{ results.match_percentage
                    }}%)</span>
                {% endif %}
            </div>
        </div>

        <div class="row">
            <!-- MAIN COLUMN (Left - Col 8) -->
            <div class="col-lg-8">

                <!-- 2. Technical Skills Evaluation (Tag Cloud) -->
                {% if results.technical_skills_evaluation %}
                <div class="glass-card mb-4 p-4 border-0 shadow-sm">
                    <h5 class="fw-bold mb-3"><i class="bi bi-cpu-fill me-2 text-primary"></i>Technical Skills</h5>

                    <div class="row g-4">
                        <div class="col-md-6">
                            <h6 class="text-success small fw-bold text-uppercase mb-2"><i
                                    class="bi bi-check-all me-1"></i>Matched Skills</h6>
                            <div class="d-flex flex-wrap gap-2">
                                {% set has_match = false %}
                                {% for item in results.technical_skills_evaluation if item.status == 'Strong Match' %}
                                {% set has_match = true %}
                                <span
                                    class="badge bg-success bg-opacity-10 text-success border border-success border-opacity-25 py-2 px-3 rounded-pill fw-medium">
                                    <i class="bi bi-check-lg me-1"></i>{{ item.skill }}
                                </span>
                                {% endfor %}
                                {% if not has_match %}
                                <span class="text-muted small fst-italic">No direct matches found.</span>
                                {% endif %}
                            </div>
                        </div>

                        <div class="col-md-6 border-start">
                            <h6 class="text-danger small fw-bold text-uppercase mb-2"><i
                                    class="bi bi-exclamation-circle me-1"></i>Missing Skills</h6>
                            <div class="d-flex flex-wrap gap-2">
                                {% set has_missing = false %}
                                {% for item in results.technical_skills_evaluation if item.status == 'Missing' %}
                                {% set has_missing = true %}
                                <span
                                    class="badge bg-danger bg-opacity-10 text-danger border border-danger border-opacity-25 py-2 px-3 rounded-pill fw-medium text-decoration-line-through">
                                    {{ item.skill }}
                                </span>
                                {% endfor %}
                                {% if not has_missing %}
                                <span class="text-success small fst-italic">All required skills present!</span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- 3. Professional Profile & Recommendations -->
                <div class="row mb-4">
                    <!-- Candidate Credentials (Left) -->
                    <div class="col-md-5">
                        <div class="glass-card h-100 p-4 border-0 shadow-sm">
                            <h6 class="text-secondary text-uppercase fw-bold small mb-4" style="letter-spacing: 0.5px;">
                                Candidate Credentials</h6>

                            <div class="mb-4">
                                <div class="d-flex align-items-center mb-1">
                                    <div class="bg-light text-primary rounded-circle p-2 me-3 d-flex align-items-center justify-content-center"
                                        style="width: 40px; height: 40px;">
                                        <i class="bi bi-briefcase-fill fs-5"></i>
                                    </div>
                                    <div>
                                        <small class="text-muted d-block" style="font-size: 0.75rem;">EXPERIENCE
                                            LEVEL</small>
                                        <span class="fw-bold text-dark">{{ results.experience_level.cv }}</span>
                                    </div>
                                </div>
                            </div>

                            <div class="mb-2">
                                <div class="d-flex align-items-center mb-1">
                                    <div class="bg-light text-primary rounded-circle p-2 me-3 d-flex align-items-center justify-content-center"
                                        style="width: 40px; height: 40px;">
                                        <i class="bi bi-mortarboard-fill fs-5"></i>
                                    </div>
                                    <div>
                                        <small class="text-muted d-block" style="font-size: 0.75rem;">EDUCATION</small>
                                        <span class="fw-bold text-dark">{{ results.education.cv | first if
                                            results.education.cv else 'Not Specified' }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Strategic Insights (Right Tabs) -->
                    <div class="col-md-7">
                        <div class="glass-card h-100 p-4 border-0 shadow-sm">
                            <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link active py-1 px-3 small fw-bold" id="pills-strengths-tab"
                                        data-bs-toggle="pill" data-bs-target="#pills-strengths" type="button"
                                        role="tab">Strengths</button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link py-1 px-3 small fw-bold" id="pills-improvements-tab"
                                        data-bs-toggle="pill" data-bs-target="#pills-improvements" type="button"
                                        role="tab">Improvements</button>
                                </li>
                            </ul>

                            <div class="tab-content" id="pills-tabContent">
                                <!-- Strengths Content -->
                                <div class="tab-pane fade show active" id="pills-strengths" role="tabpanel">
                                    {% if results.key_strengths %}
                                    <ul class="list-unstyled mb-0">
                                        {% for item in results.key_strengths %}
                                        <li class="mb-3 d-flex align-items-start text-dark small">
                                            <i class="bi bi-check-circle-fill text-success me-3 mt-1 flex-shrink-0"></i>
                                            <span style="line-height: 1.5;">{{ item }}</span>
                                        </li>
                                        {% endfor %}
                                    </ul>
                                    {% else %}
                                    <p class="text-muted small">No specific strengths detected.</p>
                                    {% endif %}
                                </div>

                                <!-- Improvements Content -->
                                <div class="tab-pane fade" id="pills-improvements" role="tabpanel">
                                    {% if results.areas_for_improvement %}
                                    <ul class="list-unstyled mb-0">
                                        {% for item in results.areas_for_improvement %}
                                        <li class="mb-3 d-flex align-items-start text-dark small">
                                            <i class="bi bi-chevron-right text-secondary me-2 mt-1"
                                                style="font-size: 0.8rem;"></i>
                                            <span style="line-height: 1.5;">{{ item }}</span>
                                        </li>
                                        {% endfor %}
                                    </ul>
                                    {% else %}
                                    <div class="d-flex align-items-center text-success small">
                                        <i class="bi bi-check-all fs-4 me-2"></i>
                                        <span>Candidate profile is well-optimized.</span>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

            <!-- SIDE COLUMN (Right - Col 4) -->
            <div class="col-lg-4">
                <div class="glass-card mb-4 text-center p-4 sticky-top border-0 shadow-sm"
                    style="top: 20px; z-index: 10;">
                    <h6 class="text-muted fw-bold mb-3 small text-uppercase">COMPATIBILITY SCORE</h6>
                    <div class="position-relative mx-auto mb-3" style="width: 160px; height: 160px;">
                        <canvas id="scoreChart"></canvas>
                        <div class="position-absolute top-50 start-50 translate-middle">
                            <h2 class="fw-bold mb-0 text-dark">{{ results.match_percentage }}%</h2>
                        </div>
                    </div>
                    <div class="row mt-4 text-center small border-top pt-3">
                        <div class="col-6 border-end">
                            <span class="d-block text-muted mb-1">Semantic Score</span>
                            <span class="badge bg-light text-dark border">{{ results.semantic_score }}%</span>
                        </div>
                        <div class="col-6">
                            <span class="d-block text-muted mb-1">Keyword Match</span>
                            <span class="badge bg-light text-dark border">{{ results.skill_match_score }}%</span>
                        </div>
                    </div>

                    <div class="mt-4">
                        <small class="text-muted text-uppercase fw-bold" style="font-size: 0.7rem;">AI
                            Recommendation</small>
                        {% if results.match_percentage >= 70 %}
                        <h5 class="text-success fw-bold mt-2">Strong Candidate</h5>
                        {% elif results.match_percentage >= 40 %}
                        <h5 class="text-warning fw-bold mt-2">Potential Fit</h5>
                        {% else %}
                        <h5 class="text-danger fw-bold mt-2">Not Recommended</h5>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="text-center py-4 mt-5" style="color: rgba(0,0,0,0.4); font-size: 0.9rem;">
        <div class="container">
            <span>Powered by <strong>Abdul Samad</strong></span>
        </div>
    </footer>

    <!-- Bootstrap Bundle with Popper (Required for Tabs) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        const ctx = document.getElementById('scoreChart').getContext('2d');
        // Use parseFloat with quotes to prevent IDE syntax errors with Jinja
        const score = parseFloat("{{ results.match_percentage | default(0) }}");
        const color = score >= 70 ? '#10B981' : (score >= 40 ? '#F59E0B' : '#EF4444');

        new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['Match', 'Gap'],
                datasets: [{
                    data: [score, 100 - score],
                    backgroundColor: [color, '#E5E7EB'],
                    borderWidth: 0,
                    cutout: '80%'
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { display: false },
                    tooltip: { enabled: false }
                },
                animation: {
                    animateScale: true,
                    animateRotate: true
                }
            }
        });
    </script>
</body>

</html>