<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HR Match AI</title>
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap"
        rel="stylesheet">
    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
    <style>
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
        }
    </style>
</head>

<body>

    <nav class="navbar navbar-expand-lg fixed-top">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="bi bi-robot me-2"></i>HR Assistant
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="/">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/about">About</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    {% if error %}
    <div class="alert alert-danger shadow-sm mb-4" role="alert">
        <i class="bi bi-exclamation-triangle-fill me-2"></i> {{ error }}
    </div>
    {% endif %}

    {% with messages = get_flashed_messages() %}
    {% if messages %}
    <div class="alert alert-danger shadow-sm mb-4" role="alert">
        {% for message in messages %}
        <i class="bi bi-exclamation-triangle-fill me-2"></i> {{ message }}<br>
        {% endfor %}
    </div>
    {% endif %}
    {% endwith %}

    <div class="hero-section">
        <h1 class="hero-title">Smart Resume Screening</h1>
        <p class="lead" style="color: black;">AI-powered semantic matching with deep learning
            insights.</p>
    </div>

    <div class="row justify-content-center">
        <div class="col-lg-10">
            <div class="glass-card">
                <form method="post" enctype="multipart/form-data" id="uploadForm">
                    <div class="row g-5">
                        <!-- CV Upload -->
                        <div class="col-md-6">
                            <h5 class="mb-3 fw-bold"><i class="bi bi-file-earmark-person me-2"></i>Candidate CV(s)</h5>
                            <div class="upload-zone" id="cv-zone">
                                <i class="bi bi-cloud-arrow-up upload-icon"></i>
                                <p class="mb-1 fw-bold">Drop CV(s) here or Browse</p>
                                <p class="text-muted small">Select multiple files at once (Up to 10 files)</p>
                                <p class="text-muted small" style="font-size: 0.75rem;"><i
                                        class="bi bi-info-circle"></i> Hold Ctrl/Cmd to select multiple files</p>
                                <input type="file" name="cv" id="cv" class="d-none" accept=".pdf,.docx,.txt" multiple>
                                <button type="button" class="btn btn-sm btn-outline-primary mt-2"
                                    onclick="document.getElementById('cv').click()">Browse Files</button>
                                <div id="cv-name" class="mt-2 text-success small fw-bold"></div>
                                <div id="cv-list" class="mt-2"></div>
                            </div>
                        </div>

                        <!-- JD Upload/Text -->
                        <div class="col-md-6">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h5 class="mb-0 fw-bold"><i class="bi bi-briefcase me-2"></i>Job Description</h5>
                                <div class="btn-group btn-group-sm" role="group">
                                    <button type="button" class="btn btn-outline-primary active" id="jd-file-btn"
                                        onclick="toggleJDMode('file')">
                                        <i class="bi bi-file-earmark"></i> Upload File
                                    </button>
                                    <button type="button" class="btn btn-outline-primary" id="jd-text-btn"
                                        onclick="toggleJDMode('text')">
                                        <i class="bi bi-textarea-t"></i> Paste Text
                                    </button>
                                </div>
                            </div>

                            <!-- File Upload Mode -->
                            <div class="upload-zone" id="jd-zone" style="display: block;">
                                <i class="bi bi-cloud-upload upload-icon"></i>
                                <p class="mb-1 fw-bold">Drop JD here</p>
                                <p class="text-muted small">PDF, DOCX, TXT</p>
                                <input type="file" name="jd" id="jd" class="d-none" accept=".pdf,.docx,.txt">
                                <button type="button" class="btn btn-sm btn-outline-primary mt-2"
                                    onclick="document.getElementById('jd').click()">Browse Files</button>
                                <div id="jd-name" class="mt-2 text-success small fw-bold"></div>
                            </div>

                            <!-- Text Input Mode -->
                            <div id="jd-text-zone" style="display: none;">
                                <textarea name="jd_text" id="jd_text" class="form-control" rows="10"
                                    placeholder="Paste or type the job description here..."
                                    style="background: rgba(255, 255, 255, 0.9); border: 2px dashed #0d6efd; border-radius: 15px; padding: 15px;"></textarea>
                                <small class="text-muted mt-2 d-block">Word count: <span
                                        id="word-count">0</span></small>
                            </div>
                        </div>
                    </div>

                    <div class="text-center mt-5">
                        <button type="submit" class="btn btn-primary-gradient px-5 py-3 fs-5">
                            <i class="bi bi-stars me-2"></i>Analyze Compatibility
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Features Section -->
    <div class="row pt-5 mt-5">
        <div class="col-12 text-center mb-5">
            <h2 class="hero-title" style="font-size: 2.5rem;">Why Choose HR Match AI?</h2>
            <p class="lead text-secondary">Streamline your recruitment process with next-gen technology.</p>
        </div>

        <div class="col-md-4">
            <div class="glass-card h-100 p-4 text-center animate-entry delay-1">
                <div class="icon-square bg-primary-subtle text-primary rounded-circle p-3 d-inline-block mb-3"
                    style="font-size: 2rem;">
                    <i class="bi bi-cpu-fill"></i>
                </div>
                <h4 class="fw-bold mb-3">AI-Powered Engine</h4>
                <p class="text-secondary small">
                    Go beyond keywords. Our advanced NLP model understands the semantic meaning of skills and
                    experiences.
                </p>
            </div>
        </div>

        <div class="col-md-4">
            <div class="glass-card h-100 p-4 text-center animate-entry delay-2">
                <div class="icon-square bg-success-subtle text-success rounded-circle p-3 d-inline-block mb-3"
                    style="font-size: 2rem;">
                    <i class="bi bi-lightning-charge-fill"></i>
                </div>
                <h4 class="fw-bold mb-3">Instant Analysis</h4>
                <p class="text-secondary small">
                    Get detailed compatibility reports in seconds. Visualize gaps and matches instantly.
                </p>
            </div>
        </div>

        <div class="col-md-4">
            <div class="glass-card h-100 p-4 text-center animate-entry delay-3">
                <div class="icon-square bg-warning-subtle text-warning rounded-circle p-3 d-inline-block mb-3"
                    style="font-size: 2rem;">
                    <i class="bi bi-shield-lock-fill"></i>
                </div>
                <h4 class="fw-bold mb-3">Secure & Private</h4>
                <p class="text-secondary small">
                    Your data is processed locally and securely. We prioritize candidate privacy and data
                    protection.
                </p>
            </div>
        </div>
    </div>
    </div>

    <footer class="text-center py-4 mt-5" style="color: rgba(0,0,0,0.4); font-size: 0.9rem;">
        <div class="container">
            <span>Powered by <strong>Abdul Samad</strong></span>
        </div>
    </footer>

    <script>
        // Toggle between JD file upload and text input
        function toggleJDMode(mode) {
            const fileZone = document.getElementById('jd-zone');
            const textZone = document.getElementById('jd-text-zone');
            const fileBtn = document.getElementById('jd-file-btn');
            const textBtn = document.getElementById('jd-text-btn');
            const jdFileInput = document.getElementById('jd');
            const jdTextInput = document.getElementById('jd_text');

            if (mode === 'file') {
                fileZone.style.display = 'block';
                textZone.style.display = 'none';
                fileBtn.classList.add('active');
                textBtn.classList.remove('active');
                jdTextInput.value = ''; // Clear text input
            } else {
                fileZone.style.display = 'none';
                textZone.style.display = 'block';
                fileBtn.classList.remove('active');
                textBtn.classList.add('active');
                jdFileInput.value = ''; // Clear file input
                document.getElementById('jd-name').textContent = '';
            }
        }

        // Word counter for JD text input
        const jdTextArea = document.getElementById('jd_text');
        if (jdTextArea) {
            jdTextArea.addEventListener('input', function () {
                const words = this.value.trim().split(/\s+/).filter(word => word.length > 0);
                document.getElementById('word-count').textContent = words.length;
            });
        }

        // Enhanced drag and drop handling for multiple files
        function setupDragDrop(zoneId, inputId, nameId) {
            const zone = document.getElementById(zoneId);
            const input = document.getElementById(inputId);
            const nameDisplay = document.getElementById(nameId);

            zone.addEventListener('dragover', (e) => {
                e.preventDefault();
                zone.classList.add('dragover');
            });

            zone.addEventListener('dragleave', () => {
                zone.classList.remove('dragover');
            });

            zone.addEventListener('drop', (e) => {
                e.preventDefault();
                zone.classList.remove('dragover');
                if (e.dataTransfer.files.length) {
                    input.files = e.dataTransfer.files;
                    updateFileDisplay(inputId, nameId);
                }
            });

            input.addEventListener('change', () => {
                updateFileDisplay(inputId, nameId);
            });
        }

        // Update file display for CV (multiple files)
        function updateFileDisplay(inputId, nameId) {
            const input = document.getElementById(inputId);
            const nameDisplay = document.getElementById(nameId);

            if (inputId === 'cv') {
                // Handle multiple CV files
                const cvList = document.getElementById('cv-list');
                cvList.innerHTML = '';

                if (input.files.length > 0) {
                    nameDisplay.textContent = `${input.files.length} file(s) selected`;

                    // Show file list
                    const listHtml = Array.from(input.files).map((file, idx) => {
                        return `
                            <div class="d-flex align-items-center justify-content-between p-2 mb-1" style="background: rgba(13, 110, 253, 0.1); border-radius: 8px;">
                                <span class="small"><i class="bi bi-file-earmark"></i> ${file.name}</span>
                                <span class="badge bg-primary">${(file.size / 1024).toFixed(1)} KB</span>
                            </div>
                        `;
                    }).join('');
                    cvList.innerHTML = listHtml;
                }
            } else {
                // Handle single JD file
                if (input.files.length) {
                    nameDisplay.textContent = "Selected: " + input.files[0].name;
                }
            }
        }

        setupDragDrop('cv-zone', 'cv', 'cv-name');
        setupDragDrop('jd-zone', 'jd', 'jd-name');

        // Form Validation
        document.getElementById('uploadForm').addEventListener('submit', function (e) {
            const cv = document.getElementById('cv');
            const jdFile = document.getElementById('jd');
            const jdText = document.getElementById('jd_text').value.trim();

            // Check if CV is provided
            if (!cv.files.length) {
                e.preventDefault();
                alert("Please select at least one CV file.");
                return;
            }

            // Check if JD is provided (either file or text)
            if (!jdFile.files.length && !jdText) {
                e.preventDefault();
                alert("Please provide a Job Description (either upload a file or paste text).");
                return;
            }

            // JD text validation - allow any length
            // Word count shown for info only
        });
    </script>
</body>

</html>